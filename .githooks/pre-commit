#!/bin/bash
# Pre-commit hook to automatically format C++ files with clang-format
# Install: git config core.hooksPath .githooks

# Find clang-format (prefer versioned, fall back to unversioned)
CLANG_FORMAT=""
for cf in clang-format-19 clang-format-18 clang-format-17 clang-format; do
    if command -v "$cf" &> /dev/null; then
        CLANG_FORMAT="$cf"
        break
    fi
done

if [ -z "$CLANG_FORMAT" ]; then
    echo "Warning: clang-format not found, skipping formatting"
    exit 0
fi

# Get staged C++ files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(cpp|hpp|h|c)$')

if [ -z "$STAGED_FILES" ]; then
    exit 0
fi

# Format each staged file
for file in $STAGED_FILES; do
    if [ -f "$file" ]; then
        $CLANG_FORMAT -i "$file"
        git add "$file"
    fi
done

echo "Formatted $(echo "$STAGED_FILES" | wc -w) file(s) with $CLANG_FORMAT"
