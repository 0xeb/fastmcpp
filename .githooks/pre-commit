#!/bin/bash
# Pre-commit hook: auto-format staged C++ files
#
# Enable with: git config core.hooksPath .githooks

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(cpp|hpp)$')

if [ -z "$STAGED_FILES" ]; then
    exit 0
fi

# Check if clang-format is available
if ! command -v clang-format &> /dev/null; then
    echo "Warning: clang-format not found, skipping auto-format"
    exit 0
fi

# Auto-format and re-stage
for file in $STAGED_FILES; do
    if [ -f "$file" ]; then
        clang-format -i "$file"
        git add "$file"
    fi
done

exit 0
